"use strict";(self["webpackChunkdemo"]=self["webpackChunkdemo"]||[]).push([[784],{37784:(e,t,o)=>{o.r(t),o.d(t,{default:()=>C});var i=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"AllBox"},[o("el-card",{staticClass:"box-card"},[o("div",{staticClass:"clearfix selectBox",attrs:{slot:"header"},slot:"header"},[o("el-button",{attrs:{type:"primary",icon:"el-icon-delete"},on:{click:e.addRole}},[e._v("添加角色")]),o("el-button",{attrs:{type:"primary",icon:"el-icon-delete"},on:{click:e.saveTreeBtn}},[e._v("保存角色")])],1),e._l(e.rolesData,(function(t){return o("div",{key:t.roleId,staticClass:"text item"},[o("div",{staticClass:"itemInfo"},[e._v(" "+e._s(t.name)+" ")]),o("div",{staticClass:"itemBtn"},[o("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-edit",circle:""},on:{click:function(o){return e.editRole(t)}}}),t.roleId>4?o("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-delete",circle:""},on:{click:function(o){return e.deleteRole(t.roleId)}}}):e._e()],1)])}))],2),o("addRolepopUp",{ref:"addRolepopUp",on:{giveFather:e.getSonData}}),o("permissionsTree",{ref:"PermissionsTree"})],1)},r=[],s=(o(68309),o(48729)),a=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"AllBox"},[o("el-dialog",{attrs:{title:"添加角色",visible:e.dialogVisible,width:"30%",center:""},on:{"update:visible":function(t){e.dialogVisible=t}}},[o("el-form",{ref:"dataForm",staticClass:"login_in",attrs:{"label-width":"0px",model:e.dataForm}},[o("div",{staticClass:"form-info"},[o("el-form-item",{attrs:{prop:"name"}},[o("el-input",{attrs:{type:"text","prefix-icon":"el-icon-user",placeholder:"请输入添加的角色名字"},model:{value:e.dataForm.name,callback:function(t){e.$set(e.dataForm,"name","string"===typeof t?t.trim():t)},expression:"dataForm.name"}})],1),o("el-form-item",{attrs:{prop:"roleKey"}},[o("el-input",{attrs:{"prefix-icon":"el-icon-user",placeholder:"请输入添加角色的别名"},model:{value:e.dataForm.roleKey,callback:function(t){e.$set(e.dataForm,"roleKey","string"===typeof t?t.trim():t)},expression:"dataForm.roleKey"}})],1)],1)]),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:e.closeDialogVisible}},[e._v("取 消")]),o("el-button",{attrs:{type:"primary"},on:{click:function(t){e.showDialogVisible(),e.giveFather()}}},[e._v("确 定")])],1)],1)],1)},n=[];const l={name:"addRolepopUp",data:function(){return{dataForm:{name:"",roleKey:"",roleId:6},dialogVisible:!1}},methods:{closeDialogVisible:function(){this.dialogVisible=!1},showDialogVisible:function(){this.dialogVisible=!this.dialogVisible},giveFather:function(){this.$emit("giveFather",this.dataForm)}}},c=l;var d=o(43736),u=(0,d.Z)(c,a,n,!1,null,null,null);const h=u.exports;var f=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{directives:[{name:"show",rawName:"v-show",value:e.isShowTree,expression:"isShowTree"}],staticClass:"TreeBox"},[o("div",{staticClass:"headerBox"},[o("el-button",{staticClass:"backBtn",attrs:{type:"primary",size:"mini",icon:"el-icon-edit"},on:{click:e.backEdit}},[e._v("退出编辑")]),o("el-tag",{staticClass:"roleTitle"},[e._v("编辑的角色是")]),o("el-tag",{staticClass:"roleTitle",attrs:{type:"danger"}},[e._v(e._s(e.roleName))])],1),o("el-tree",{ref:"tree",staticClass:"TreeMain",attrs:{data:e.Tree,"show-checkbox":"","node-key":"menuId","default-checked-keys":e.roleTree}})],1)},m=[],p=(o(89554),o(41539),o(54747),function(e,t){var o=[],i={},r=t;return o=e,o.forEach((function(e){i.menuId=e.menuId,r.push(i),i={}})),r});const v={name:"permissionsTree",data:function(){return{Tree:[],roleTree:[],isShowTree:!1,modifyRight:[],roleName:""}},mounted:function(){this.getTree()},methods:{showTreeList:function(e,t,o){var i=this;this.roleName=o,this.roleTree=[],(0,s.pR)(e).then((function(e){if(console.log(e.data.data),200===e.data.code){var o=e.data.data;o.forEach((function(e){4===e.level&&t.push(e.menuId)})),console.log("check",i.roleTree),i.roleTree=t,console.log(i.roleTree),i.isShowTree=!0}}))},getTree:function(){var e=this;(0,s.IM)().then((function(t){200===t.data.code&&(e.Tree=t.data.data)}))},getCheckedNodes:function(){var e=p(this.$refs.tree.getCheckedNodes(),this.modifyRight);this.modifyRight=e},getHalfCheckedNodes:function(){var e=p(this.$refs.tree.getHalfCheckedNodes(),this.modifyRight);this.modifyRight=e},saveRoleTreeBtn:function(e){var t=this;if(!1===this.isShowTree)this.$message.error("请查看角色权限后再保存");else{this.getCheckedNodes(),this.getHalfCheckedNodes();var o={};o.roleId=e,o.menuList=this.modifyRight,(0,s.Y2)(o).then((function(e){200===e.data.code?(t.$message.success("修改角色权限成功！"),t.isShowTree=!1):t.$message.error("修改角色权限失败,请重新操作！"),t.modifyRight=[]}))}},backEdit:function(){this.$refs.tree.setCheckedKeys([]),this.$parent.showTree=!1,this.isShowTree=!1}}},g=v;var T=(0,d.Z)(g,f,m,!1,null,"14ff3055",null);const y=T.exports,b={data:function(){return{rolesData:[],roleId:0,showTree:!1}},components:{addRolepopUp:h,PermissionsTree:y},mounted:function(){this.getRoles()},methods:{getRoles:function(){var e=this;(0,s.JV)().then((function(t){200===t.data.code?e.rolesData=t.data.data:e.$message.error("系统繁忙，请重新进入！")}))},addRole:function(){this.$refs.addRolepopUp.showDialogVisible()},editRole:function(e){console.log(e),!1===this.showTree?(this.showTree=!0,this.roleId=e.roleId,this.$refs.PermissionsTree.showTreeList(e.roleId,[],e.name)):this.$message.error("请先退出编辑后再查看对应角色的权限")},deleteRole:function(e){var t=this;(0,s.Fe)(e).then((function(e){200===e.data.code?(t.$message.success("删除角色成功！"),t.getRoles()):t.$message.error("删除角色失败，请稍后重试！")}))},saveTreeBtn:function(){this.$refs.PermissionsTree.saveRoleTreeBtn(this.roleId)},getSonData:function(e){var t=this;(0,s._d)(e).then((function(e){200===e.data.code&&t.getRoles()}))}}},k=b;var R=(0,d.Z)(k,i,r,!1,null,"56fdee0f",null);const C=R.exports},48729:(e,t,o)=>{o.d(t,{DZ:()=>h,EJ:()=>m,Fe:()=>c,IM:()=>n,JV:()=>r,W1:()=>p,Xu:()=>d,Y2:()=>l,_d:()=>s,cn:()=>f,e1:()=>u,pR:()=>a,q0:()=>v,xZ:()=>g});var i=o(44498),r=function(){var e="/admin/roles";return i.Z.get(e)},s=function(e){var t="/admin/roles";return i.Z.post(t,e)},a=function(e){var t="/admin/roles/menu/".concat(e);return i.Z.get(t)},n=function(){var e="/admin/menus/tree";return i.Z.get(e)},l=function(e){var t="/admin/roles/menu";return i.Z.put(t,e)},c=function(e){var t="/admin/roles/".concat(e);return i.Z["delete"](t)},d=function(e){var t="/admin/users/pages/".concat(e);return i.Z.get(t)},u=function(e){var t="/admin/users/role";return i.Z.put(t,e)},h=function(e){var t="/admin/users/".concat(e);return i.Z["delete"](t)},f=function(e){var t="/admin/users";return i.Z.post(t,e)},m=function(e){var t="/admin/logs/pages/".concat(e);return i.Z.get(t)},p=function(e){var t="/admin/logs/".concat(e);return i.Z["delete"](t)},v=function(e){var t="/admin/logs";return i.Z.post(t,e)},g=function(e){var t="/admin/users/role/".concat(e);return i.Z.get(t)}}}]);
//# sourceMappingURL=784.8cb2e655.js.map