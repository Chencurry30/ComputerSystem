"use strict";(self["webpackChunkadmin"]=self["webpackChunkadmin"]||[]).push([[309],{4309:function(e,t,s){s.r(t),s.d(t,{default:function(){return w}});var r=function(){var e=this,t=e._self._c;return t("div",{staticClass:"AllBox"},[t("el-card",{staticClass:"box-card"},[t("div",{staticClass:"clearfix selectBox",attrs:{slot:"header"},slot:"header"},[t("el-button",{directives:[{name:"has",rawName:"v-has",value:"system:role:add",expression:"`system:role:add`"}],attrs:{type:"primary",icon:"el-icon-delete"},on:{click:e.addRole}},[e._v("添加角色")]),t("el-button",{attrs:{type:"primary",icon:"el-icon-delete"},on:{click:e.saveTreeBtn}},[e._v("保存角色")])],1),e._l(e.rolesData,(function(s){return t("div",{key:s.roleId,staticClass:"text item"},[t("div",{staticClass:"itemInfo"},[e._v(" "+e._s(s.name)+" ")]),t("div",{staticClass:"itemBtn"},[t("el-button",{directives:[{name:"has",rawName:"v-has",value:"system:role:getMenu",expression:"`system:role:getMenu`"}],attrs:{type:"primary",size:"mini",icon:"el-icon-edit",circle:""},on:{click:function(t){return e.editRole(s)}}}),s.roleId>4?t("el-button",{directives:[{name:"has",rawName:"v-has",value:"system:role:delete",expression:"`system:role:delete`"}],attrs:{type:"primary",size:"mini",icon:"el-icon-delete",circle:""},on:{click:function(t){return e.deleteRole(s.roleId)}}}):e._e()],1)])}))],2),t("addRolepopUp",{ref:"addRolepopUp",on:{giveFather:e.getSonData}}),t("permissionsTree",{ref:"PermissionsTree"})],1)},o=[],i=s(8729),a=function(){var e=this,t=e._self._c;return t("div",{staticClass:"AllBox"},[t("el-dialog",{attrs:{title:"添加角色",visible:e.dialogVisible,width:"30%",center:""},on:{"update:visible":function(t){e.dialogVisible=t}}},[t("el-form",{ref:"dataForm",staticClass:"login_in",attrs:{"label-width":"0px",model:e.dataForm}},[t("div",{staticClass:"form-info"},[t("el-form-item",{attrs:{prop:"name"}},[t("el-input",{attrs:{type:"text","prefix-icon":"el-icon-user",placeholder:"请输入添加的角色名字"},model:{value:e.dataForm.name,callback:function(t){e.$set(e.dataForm,"name","string"===typeof t?t.trim():t)},expression:"dataForm.name"}})],1),t("el-form-item",{attrs:{prop:"roleKey"}},[t("el-input",{attrs:{"prefix-icon":"el-icon-user",placeholder:"请输入添加角色的别名"},model:{value:e.dataForm.roleKey,callback:function(t){e.$set(e.dataForm,"roleKey","string"===typeof t?t.trim():t)},expression:"dataForm.roleKey"}})],1)],1)]),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:e.closeDialogVisible}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){e.showDialogVisible(),e.giveFather()}}},[e._v("确 定")])],1)],1)],1)},n=[],l={name:"addRolepopUp",data(){return{dataForm:{name:"",roleKey:"",roleId:6},dialogVisible:!1}},methods:{closeDialogVisible(){this.dialogVisible=!1},showDialogVisible(){this.dialogVisible=!this.dialogVisible},giveFather(){this.$emit("giveFather",this.dataForm)}}},d=l,c=s(1001),u=(0,c.Z)(d,a,n,!1,null,null,null),h=u.exports,m=function(){var e=this,t=e._self._c;return t("div",{directives:[{name:"show",rawName:"v-show",value:e.isShowTree,expression:"isShowTree"}],staticClass:"TreeBox"},[t("div",{staticClass:"headerBox"},[t("el-tag",{staticClass:"roleTitle"},[e._v("编辑的角色是")]),t("el-tag",{staticClass:"roleTitle",attrs:{type:"danger"}},[e._v(e._s(e.roleName))])],1),t("el-tree",{ref:"tree",staticClass:"TreeMain",attrs:{data:e.Tree,"show-checkbox":"","node-key":"menuId","default-checked-keys":e.roleTree}})],1)},f=[];s(7658);const p=(e,t)=>{let s=[],r={},o=t;return s=e,s.forEach((e=>{r.menuId=e.menuId,o.push(r),r={}})),o};var g={name:"permissionsTree",data(){return{Tree:[],roleTree:[],isShowTree:!1,modifyRight:[],roleName:""}},mounted(){this.getTree()},methods:{showTreeList(e,t,s){this.$refs.tree.setCheckedKeys([]),this.roleName=s,this.roleTree=[],(0,i.pR)(e).then((e=>{if(console.log(e),200===e.data.code){let s=e.data.data;s.forEach((e=>{4===e.level&&t.push(e.menuId)})),console.log("check",this.roleTree),this.roleTree=t,this.isShowTree=!0}else 417===e.data.code&&(this.roleTree=[],console.log(typeof this.roleTree),this.isShowTree=!0)}))},getTree(){(0,i.IM)().then((e=>{200===e.data.code&&(this.Tree=e.data.data)}))},getCheckedNodes(){let e=p(this.$refs.tree.getCheckedNodes(),this.modifyRight);this.modifyRight=e},getHalfCheckedNodes(){let e=p(this.$refs.tree.getHalfCheckedNodes(),this.modifyRight);this.modifyRight=e},saveRoleTreeBtn(e){if(!1===this.isShowTree)this.$message.error("请查看角色权限后再保存");else{this.getCheckedNodes(),this.getHalfCheckedNodes();let t={};t.roleId=e,t.menuList=this.modifyRight,(0,i.Y2)(t).then((e=>{200===e.data.code?(this.$message.success("修改角色权限成功！"),this.isShowTree=!1):this.$message.error("修改角色权限失败,请重新操作！"),this.modifyRight=[]}))}}}},v=g,y=(0,c.Z)(v,m,f,!1,null,"3422baee",null),T=y.exports,b={data(){return{rolesData:[],roleId:0,showTree:!1}},components:{addRolepopUp:h,PermissionsTree:T},mounted(){this.getRoles()},methods:{getRoles(){(0,i.JV)().then((e=>{console.log(e),200===e.data.code?this.rolesData=e.data.data:403===e.data.code&&this.$message.error("权限不足！！！")}))},addRole(){this.$refs.addRolepopUp.showDialogVisible()},editRole(e){this.showTree=!0,this.roleId=e.roleId,this.$refs.PermissionsTree.showTreeList(e.roleId,[],e.name)},deleteRole(e){(0,i.Fe)(e).then((e=>{200===e.data.code?(this.$message.success("删除角色成功！"),this.getRoles()):this.$message.error("删除角色失败，请稍后重试！")}))},saveTreeBtn(){this.$refs.PermissionsTree.saveRoleTreeBtn(this.roleId)},getSonData(e){(0,i._d)(e).then((e=>{200===e.data.code&&this.getRoles()}))}}},R=b,k=(0,c.Z)(R,r,o,!1,null,"598a71e4",null),w=k.exports},8729:function(e,t,s){s.d(t,{DZ:function(){return h},EJ:function(){return f},Fe:function(){return d},IM:function(){return n},JV:function(){return o},W1:function(){return p},Xu:function(){return c},Y2:function(){return l},_d:function(){return i},cn:function(){return m},e1:function(){return u},pR:function(){return a},q0:function(){return g},xZ:function(){return v}});var r=s(4498);const o=()=>{const e="/admin/roles";return r.Z.get(e)},i=e=>{const t="/admin/roles";return r.Z.post(t,e)},a=e=>{const t=`/admin/roles/menu/${e}`;return r.Z.get(t)},n=()=>{const e="/admin/menus/tree";return r.Z.get(e)},l=e=>{const t="/admin/roles/menu";return r.Z.put(t,e)},d=e=>{const t=`/admin/roles/${e}`;return r.Z["delete"](t)},c=e=>{const t=`/admin/users/pages/${e}`;return r.Z.get(t)},u=e=>{const t="/admin/users/role";return r.Z.put(t,e)},h=e=>{const t=`/admin/users/${e}`;return r.Z["delete"](t)},m=e=>{const t="/admin/users";return r.Z.post(t,e)},f=e=>{const t=`/admin/logs/pages/${e}`;return r.Z.get(t)},p=e=>{const t=`/admin/logs/${e}`;return r.Z["delete"](t)},g=e=>{const t="/admin/logs";return r.Z.post(t,e)},v=e=>{const t=`/admin/users/role/${e}`;return r.Z.get(t)}}}]);
//# sourceMappingURL=309.34db52d2.js.map