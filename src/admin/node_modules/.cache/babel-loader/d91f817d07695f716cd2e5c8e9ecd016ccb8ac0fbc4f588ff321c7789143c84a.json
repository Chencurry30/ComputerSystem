{"ast":null,"code":"import { uploadQuestionPicture } from '../../services/questionManage';\nexport default {\n  data() {\n    return {\n      // totleUrl: '',\n      objectData: {\n        OSSAccessKeyId: \"\",\n        policy: \"\",\n        Signature: \"\",\n        key: \"\",\n        host: '',\n        dir: ''\n      }\n    };\n  },\n  methods: {\n    //上传图片的功能(file,location)分别为文件名和传入的存储路径\n    getPolicy(file) {\n      let location = this.returnImgLocation;\n      let fileName = file.name;\n      console.log(location);\n      console.log(this.$parent.prop);\n      console.log(this.$parent.$parent.$parent.$parent.ruleForm);\n      return new Promise((resolve, reject) => {\n        uploadQuestionPicture({\n          fileName,\n          location\n        }).then(res => {\n          console.log(res);\n          this.objectData.OSSAccessKeyId = res.data.data.accessid; // Bucket拥有者的AccessKey ID。\n          this.objectData.policy = res.data.data.policy; //Policy规定了请求表单域的合法性。\n          this.objectData.Signature = res.data.data.signature; //根据AccessKey Secret和Policy计算的签名信息，OSS验证该签名信息从而验证该Post请求的合法性。\n          this.objectData.dir = res.data.data.dir; //前缀\n          this.objectData.host = res.data.data.host; // \"https://\" + bucketname + '.' + endpoint;  (前端请求oss服务路径)\n          this.objectData.key = res.data.data.key; //dir + fileName (上传Object的名称。)\n          console.log(this.$parent.$parent.$parent);\n          if (this.$parent.prop === 'answerImage') {\n            console.log(this.$parent.$parent.$parent);\n            this.$parent.$parent.$parent.$parent.ruleForm.answerImage = res.data.data.key;\n          } else if (this.$parent.prop === 'enclosureImage') {\n            this.$parent.$parent.$parent.$parent.ruleForm.enclosureImage = res.data.data.key;\n          } else if (this.$parent.prop === 'solutionImage') {\n            this.$parent.$parent.$parent.$parent.ruleForm.solutionImage = res.data.data.key;\n          } else if (this.$parent.prop === 'titleImage') {\n            this.$parent.$parent.$parent.$parent.ruleForm.titleImage = res.data.data.key;\n          } else {\n            let count = this.$parent.label.substring(0, 1);\n            console.log(this.$parent.$parent.$parent.ruleForm.questionChoiceList[count - 1]);\n            this.$parent.$parent.$parent.ruleForm.questionChoiceList[count - 1].titleImage = res.data.data.key;\n          }\n          console.log(this.objectData);\n          resolve(true);\n        }).catch(err => {\n          console.log(err);\n          reject(false);\n        });\n      });\n    }\n  },\n  computed: {\n    //判断图片在OSS上的存储路径 \n    returnImgLocation() {\n      //答案的图片 \n      if (this.$parent.prop === 'answerImage') {\n        //将获取到的文件上传到OSS，且传入相应的路径 \n        return 'answer';\n        //题目中出现的图片(如右侧的图片) \n      } else if (this.$parent.prop === 'enclosureImage') {\n        return 'enclosure';\n        //解答的图片 \n      } else if (this.$parent.prop === 'solutionImage') {\n        return 'solution';\n        //题目的图片(如题目有特殊符号) \n      } else if (this.$parent.prop === 'titleImage') {\n        return 'title';\n      } else {\n        return 'options';\n      }\n    }\n  }\n};","map":{"version":3,"mappings":"AAeA;AACA;EACAA;IACA;MACA;MACAC;QACAC;QACAC;QACAC;QACAC;QACAC;QACAC;MACA;IACA;EACA;EACAC;IACA;IACAC;MACA;MACA;MACAC;MACAA;MACAA;MACA;QACAC;UAAAC;UAAAC;QAAA,GACAC;UACAJ;UACA;UACA;UACA;UACA;UACA;UACA;UACAA;UACA;YACAA;YACA;UACA;YACA;UACA;YACA;UACA;YACA;UACA;YACA;YACAA;YACA;UACA;UACAA;UACAK;QACA,GACAC;UACAN;UACAO;QACA;MAEA;IACA;EAGA;EACAC;IACA;IACAC;MACA;MACA;QACA;QACA;QACA;MACA;QACA;QACA;MACA;QACA;QACA;MACA;QACA;MACA;QACA;MACA;IACA;EACA;AACA","names":["data","objectData","OSSAccessKeyId","policy","Signature","key","host","dir","methods","getPolicy","console","uploadQuestionPicture","fileName","location","then","resolve","catch","reject","computed","returnImgLocation"],"sourceRoot":"src/components/upload","sources":["elUpload.vue"],"sourcesContent":["<!--上传题目图片的相关弹窗-->\r\n<template>\r\n  <el-upload\r\n    class=\"upload-demo\"\r\n    :action=\"objectData.host\" \r\n    :before-upload=\"getPolicy\" \r\n    :data=\"objectData\"\r\n    :show-file-list=\"false\"\r\n    list-type=\"picture\"\r\n    >\r\n    <el-button size=\"small\" type=\"primary\">点击上传</el-button>\r\n  </el-upload>\r\n  </template>\r\n  \r\n  <script>\r\n  import {uploadQuestionPicture} from '../../services/questionManage'\r\n  export default {\r\n    data() {\r\n      return {\r\n        // totleUrl: '',\r\n        objectData: {\r\n          OSSAccessKeyId: \"\",\r\n          policy: \"\",\r\n          Signature: \"\",\r\n          key: \"\",\r\n          host: '',\r\n          dir: ''\r\n        },\r\n      };\r\n    },\r\n    methods: {\r\n      //上传图片的功能(file,location)分别为文件名和传入的存储路径\r\n      getPolicy(file){\r\n        let location = this.returnImgLocation\r\n        let fileName = file.name;\r\n        console.log(location);\r\n        console.log(this.$parent.prop);\r\n        console.log(this.$parent.$parent.$parent.$parent.ruleForm);\r\n        return new Promise(((resolve, reject) => {\r\n          uploadQuestionPicture({fileName,location})\r\n            .then(res => {\r\n              console.log(res);\r\n              this.objectData.OSSAccessKeyId = res.data.data.accessid; // Bucket拥有者的AccessKey ID。\r\n              this.objectData.policy = res.data.data.policy; //Policy规定了请求表单域的合法性。\r\n              this.objectData.Signature = res.data.data.signature;//根据AccessKey Secret和Policy计算的签名信息，OSS验证该签名信息从而验证该Post请求的合法性。\r\n              this.objectData.dir = res.data.data.dir;//前缀\r\n              this.objectData.host = res.data.data.host;// \"https://\" + bucketname + '.' + endpoint;  (前端请求oss服务路径)\r\n              this.objectData.key = res.data.data.key;//dir + fileName (上传Object的名称。)\r\n              console.log(this.$parent.$parent.$parent);\r\n              if(this.$parent.prop === 'answerImage'){\r\n                console.log(this.$parent.$parent.$parent);\r\n                this.$parent.$parent.$parent.$parent.ruleForm.answerImage = res.data.data.key\r\n              }else if(this.$parent.prop === 'enclosureImage'){\r\n                this.$parent.$parent.$parent.$parent.ruleForm.enclosureImage = res.data.data.key\r\n              }else if(this.$parent.prop === 'solutionImage'){\r\n                this.$parent.$parent.$parent.$parent.ruleForm.solutionImage = res.data.data.key\r\n              }else if(this.$parent.prop === 'titleImage'){\r\n                this.$parent.$parent.$parent.$parent.ruleForm.titleImage = res.data.data.key\r\n              }else{\r\n                let count = this.$parent.label.substring(0,1);\r\n                console.log(this.$parent.$parent.$parent.ruleForm.questionChoiceList[count-1]);\r\n                this.$parent.$parent.$parent.ruleForm.questionChoiceList[count-1].titleImage = res.data.data.key\r\n              }\r\n              console.log(this.objectData);\r\n              resolve(true);\r\n            })\r\n            .catch(err => {\r\n              console.log(err);\r\n              reject(false);\r\n            })\r\n  \r\n        }))\r\n      },\r\n  \r\n  \r\n    },\r\n    computed:{\r\n      //判断图片在OSS上的存储路径 \r\n      returnImgLocation(){\r\n        //答案的图片 \r\n        if (this.$parent.prop === 'answerImage') {\r\n          //将获取到的文件上传到OSS，且传入相应的路径 \r\n          return 'answer'\r\n        //题目中出现的图片(如右侧的图片) \r\n        }else if(this.$parent.prop === 'enclosureImage'){\r\n          return  'enclosure'\r\n        //解答的图片 \r\n        }else if(this.$parent.prop === 'solutionImage'){\r\n          return 'solution'\r\n        //题目的图片(如题目有特殊符号) \r\n        }else if(this.$parent.prop === 'titleImage'){\r\n          return 'title'\r\n        }else{\r\n          return 'options'\r\n        }\r\n      }\r\n    }\r\n  }\r\n  </script>\r\n  \r\n  <style scoped lang=\"less\">\r\n  .upload-demo{\r\n    margin-left: 10px;\r\n  }\r\n  .el-button--small {\r\n      padding: 12px 15px;\r\n      font-size: 12px;\r\n      border-radius: 3px;\r\n  }\r\n  </style>"]},"metadata":{},"sourceType":"module","externalDependencies":[]}